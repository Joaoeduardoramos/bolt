{% set schema = bolt.data.components["@bolt-components-button"].schema %}

{% if enable_json_schema_validation %}
  {{ validate_data_schema(schema, _self) | raw }}
{% endif %}

{# Variables #}
{% set this = init(schema) %}
{% set attributes = create_attribute(attributes|default({})) %}

{# Set up checks to validate that the component's prop values are allowed, based on the component's schema #}
{% set size_options = this.data.size.value %}
{% set style_options = this.data.style.value %}
{% set width_options = this.data.width.value %}
{% set border_radius_options = this.data.border_radius.value %}
{% set align_options = this.data.align.value %}
{% set transform_options = this.data.transform.value %}
{% set icon_positions = this.data.icon.properties.position.value %}
{% set iconOnly_options = this.data.iconOnly.value %}
{% set type_options = this.data.type.value %}

{# Check that the component's current prop values are valid. if not, default to the schema default #}
{% set size = size in size_options ? size : schema.properties.size.default %}
{% set style = style in style_options ? style : schema.properties.style.default %}
{% set width = width in width_options ? width : schema.properties.width.default %}
{% set border_radius = border_radius in border_radius_options ? border_radius : schema.properties.border_radius.default %}
{% set align = align in align_options ? align : schema.properties.align.default %}
{% set transform = transform in transform_options ? transform : schema.properties.transform.default %}
{% set iconOnly = iconOnly is sameas(true) or iconOnly is sameas(false) ? iconOnly : scheuma.properties.iconOnly.default %}

{# choose a semantic <a> tag or <button> tag for better accessibility, depending on whether or not a url is getting passed along #}
{% if url != null %}
  {% set tag = "a" %}
  {% if disabled %}
    {% set attributes = attributes.setAttribute("aria-disabled", "true") %}
  {% else %}
    {% if url %}
      {% set attributes = attributes.setAttribute("href", url) %}
    {% endif %}
  {% endif %}
  {% if attributes.target %}
    {% set attributes = attributes.setAttribute("target", attributes.target) %}
  {% endif %}
{% else %}
  {% set tag = "button" %}
  {% if type in type_options %}
    {% set attributes = attributes.setAttribute("type", type ) %}
  {% endif %}
{% endif %}

{# Array of classes based on the defined + default props #}
{% set classes = [
  "c-bolt-button",
  disabled ? "c-bolt-button--disabled" : "",
  size ? "c-bolt-button--#{size}" : "",
  style ? "c-bolt-button--#{style}" : "",
  width != "auto" ? "c-bolt-button--#{width}" : "",
  border_radius ? "c-bolt-button--border-radius-#{border_radius}" : "",
  align ? "c-bolt-button--#{align}" : "",
  transform != "none" ? "c-bolt-button--#{transform}" : "",
  iconOnly ? "c-bolt-button--icon-only",
] %}

{# Filter out classes that begin with `c-bolt-*`. These should never be passed in via atttributes. #}
{% for class in attributes["class"] %}
  {% if class starts with "c-bolt-" == false %}
    {% set classes = classes|merge([class]) %}
  {% endif %}
{% endfor %}

{% if disabled %}
  {% set attributes = attributes.setAttribute("disabled", true) %}
{% endif %}

{% if icon %}
  {% set icon_position = icon.position ? icon.position : schema.properties.icon.properties.position.default %}
{% endif %}

{% macro slottedIcon(icon, icon_position, slotName) %}
  {% if icon and icon_position == slotName %}
    <span class="c-bolt-button__icon c-bolt-button__icon-sizer">
      {% set icon = icon | merge({
        attributes: {
          slot: slotName,
          class: icon.attributes.class | default([])
        }
      }) %}
      {% include "@bolt-components-icon/icon.twig" with icon only %}
    </span>
  {% endif %}
{% endmacro %}

{% import _self as macros %}

<{{ tag }}
  {% if url %}
    href="{{ url }}"
    {% if target %}target="{{ target }}" {% endif %}
  {% endif %}
  class="{{ classes|join(' ') }}"
  {{ attributes|without("url")|without("href")|without("target")|without("class") }}
>

  {% block slot_before %}
    {{ macros.slottedIcon(icon, icon_position, "before") }}
  {% endblock %}
  <span class="c-bolt-button__item">{{ text }}</span>
  {% block slot_after %}
    {{ macros.slottedIcon(icon, icon_position, 'after') }}
  {% endblock %}

</{{ tag }}>
