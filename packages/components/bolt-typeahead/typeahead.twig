{% set selectors = get_data("@bolt-components-typeahead/typeahead.scoped.json") %}

{% set classNames = {
  icon: selectors["c-bolt-typeahead__icon"],
  clearIcon: selectors["c-bolt-typeahead__icon--clear"],
  clearButton: [
    selectors["c-bolt-typeahead__button"],
    selectors["c-bolt-typeahead__button--clear"],
  ],
  submitButton: [
    selectors["c-bolt-typeahead__button"],
    selectors["c-bolt-typeahead__button--submit"],
  ],
  input: selectors["c-bolt-typeahead__input"],
  inputWrapper: selectors["c-bolt-typeahead__input-wrapper"],
  label: selectors["c-bolt-typeahead__label"],
  typeahead: selectors["c-bolt-typeahead"],
} %}

{% set utils = {
  visuallyHidden: "u-bolt-visuallyhidden",
  hidden: "u-bolt-hidden"
} %}

{% set text = {
  label: "Search the website",
  submit: "Search the website",
  clearInput: "Clear search input",
  inputPlaceholder: "Enter to search"
} %}

{% set data = {
  uuid: "bolt-typeahead-uuid"
} %}

{% set attributes = create_attribute(attributes|default({})) %}
{% set fallback_form = {
  method: 'get',
  action: 'https://www.pega.com/search',
  target: '_blank'
} %}

{% spaceless %}
<bolt-typeahead {{ attributes }} placeholder="{{ text.inputPlaceholder }}" fallback-method="{{ fallback_form.method }}" fallback-action="{{ fallback_form.action }}"
 fallback-target="{{ fallback_form.target }}">
  <div class="{{ classNames.typeahead }}">
    <form class="{{ classNames.inputWrapper }}" method="{{ fallback_form.method }}" action="{{ fallback_form.action }}" target="{{ fallback_form.target }}">
      <label for="{{ data.uuid }}" class="{{ classNames.label }}">
        <span class="{{ utils.visuallyHidden }}">{{ text.label }}</span>
      </label>
      <input
        id="{{ data.uuid }}"
        type="text"
        autocomplete="off"
        aria-autocomplete="list"
        class="{{ classNames.input }}"
        placeholder="{{ text.inputPlaceholder }}"
        value="{{ initialValue }}"
        required
        name="q"
      />
      {% include "@bolt-components-button/button.twig" with {
        text: text.clearInput,
        iconOnly: true,
        color: "text",
        icon: {
          title: text.clearInput,
          name: "close-solid",
          preload: true,
          attributes: {
            class: [
              classNames.icon
            ]
          }
        },
        attributes: {
          onclick: "this.previousElementSibling.focus()",
          class: [
            classNames.clearButton | join(' ')
          ],
        },
        type: "reset"
      } only %}

      <div class="{{ classNames.submitButton | join(' ') }}">
        {% include "@bolt-components-button/button.twig" with {
          text: text.submit,
          iconOnly: true,
          color: "text",
          icon: {
            title: text.submit,
            name: "search",
            preload: true,
            attributes: {
              class: [
                classNames.icon
              ]
            }
          },
          type: "submit"
        } only %}
      </div>
    </form>
  </div>
</bolt-typeahead>
{% endspaceless %}