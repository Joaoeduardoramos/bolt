{% if enable_json_schema_validation %}
  {{ validate_data_schema(bolt.data.components['@bolt-components-icon'].schema, _self) | raw }}
{% endif %}

{% set attributes = create_attribute(attributes | default({})) %}
{% set inner_attributes = create_attribute({
  class: [
    "c-bolt-icon",
    "c-bolt-icon--" ~ size
  ]
}) %}
{% set svg_attributes = create_attribute({
  class: [
    "c-bolt-icon__icon"
  ]
}) %}

{% set attributes = attributes
  .setAttribute("name", name)
  .setAttribute("background", background)
  .setAttribute("size", size)
  .setAttribute("color", color)
  .setAttribute("title", title)
%}

{% set icon_filters %}
  <filter id="invert" x="-20%" y="-20%" width="140%" height="140%" filterUnits="objectBoundingBox" primitiveUnits="userSpaceOnUse" color-interpolation-filters="linearRGB">
    <feComponentTransfer x="0%" y="0%" width="100%" height="100%" in="SourceAlpha" result="componentTransfer">
      <feFuncR type="table" tableValues="1 0 1"/>
      <feFuncG type="table" tableValues="1 0 1"/>
      <feFuncB type="table" tableValues="1 0 1"/>
      <feFuncA type="table" tableValues="0 1"/>
    </feComponentTransfer>
  </filter>
{% endset %}

<bolt-icon {{ attributes }}>{% spaceless %}
  {% block icon_inner %}
    {% if preload %}
      {% set svgIcon %}
        {% include "@bolt-icon-assets/#{name}.min.svg" ignore missing %}
      {% endset %}

      <div {{ inner_attributes }}>
        {% if 'colored' in name %}
          {{ svgIcon  | replace('<svg ', '<svg ' ~ svg_attributes) }}
        {% else %}
          {{ svgIcon
            | replace('fill="#FFF"', 'filter="url(#invert)" fill="currentColor"')
            | replace('fill="none"', '_fill="none"')
            | replace('/ fill="((?!(var(--bolt-theme-icon|none)).*$)[^"]+)"/', ' fill="currentColor"')
            | replace('_fill="', 'fill="')
            | replace('<svg ', '<svg ' ~ svg_attributes)
            | replace('</svg>', icon_filters ~ '</svg>')
            | replace('<path d="M0 0h24v24H0z"/>', '')
          }}
        {% endif %}
      </div>
    {% endif %}
  {% endblock %}
{% endspaceless %}</bolt-icon>
