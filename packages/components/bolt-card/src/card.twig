{% set schema = bolt.data.components["@bolt-components-card"].schema %}

{% if enable_json_schema_validation %}
  {{ validate_data_schema(schema, _self) | raw }}
{% endif %}

{# Variables #}
{% set base_class = "c-bolt-card" %}
{% set attributes = create_attribute(attributes|default({})) %}
{% set inner_attributes = create_attribute({}) %}

{# Set up checks to validate that the component's prop values are allowed, based on the component's schema #}
{% set tag_options = schema.properties.tag.enum %}
{% set theme_options = schema.properties.theme.enum %}
{% set height_options = schema.properties.height.enum %}

{# Check that the component's current prop values are valid. if not, default to the schema default #}
{% set tag = tag in tag_options ? tag : schema.properties.tag.default %}
{% set theme = theme in theme_options ? theme : schema.properties.theme.default %}
{% set height = height in height_options ? height : schema.properties.height.default %}


{# card component's custom element wrapper #}
<bolt-card
  {% if tag %} tag="{{ tag }}" {% endif %}
  {% if theme %} theme="{{ theme }}" {% endif %}
  {% if height %} height="{{ height }}" {% endif %}
  {% if url %} url="{{ url }}" {% endif %}
  {{ attributes }}
>
  {# This sets none values to not render anything. #}
  {% set theme = theme == "none" ? false : theme %}

  {# Array of classes based on the defined + default props #}
  {% set classes = [
    base_class,
    theme in theme_options ? "t-bolt-#{theme}" : "",
    url ? "#{base_class}--actionable" : "",
  ] %}

  <{{ tag }} {{ inner_attributes.addClass(classes) }}>
    {% if items %}
      {% for item in items %}
        {% if item is iterable %}
          {{ item.content | join("") }}
        {% else %}
          {{ item }}
        {% endif %}
      {% endfor %}
    {% else %}
      {% if media %}
        <div class="{{ "#{base_class}__media" }}">
          {% set card_image = media.image %}
          {% set card_video = media.video %}

          {% if card_image %}
            {% include "@bolt-components-image/image.twig" with {
              src: card_image.src,
              alt: card_image.alt,
              lazyload: true,
            } only %}
          {% endif %}

          {% if card_video %}
            {% include "@bolt-components-video/video.twig" with {
              videoId: card_video.id,
              accountId: card_video.account_id,
              playerId: card_video.player_id,
              showMeta: true,
              showMetaTitle: false,
            } only %}
          {% endif %}
        </div>
      {% endif %}
      {% if body %}
        {% if tag == "figure" %}
          {% set content_tag = "figcaption" %}
        {% else %}
          {% set content_tag = "div" %}
        {% endif %}

        {% set card_eyebrow = body.eyebrow %}
        {% set card_headline = body.headline %}
        {% set card_subheadline = body.subheadline %}
        {% set card_paragraph = body.paragraph %}

        <{{ content_tag }} class="{{ "#{base_class}__body" }}">
          {% if card_eyebrow %}
            {% include "@bolt-components-headline/eyebrow.twig" with {
              text: card_eyebrow,
            } only %}
          {% endif %}
          {% if card_headline %}
            {% include "@bolt-components-headline/headline.twig" with {
              text: card_headline,
              size: "large",
            } only %}
          {% endif %}
          {% if card_paragraph %}
            {% include "@bolt-components-headline/text.twig" with {
              text: card_paragraph,
            } only %}
          {% endif %}
        </{{ content_tag }}>
      {% endif %}
      {% if actions %}
        <div class="{{ "#{base_class}__actions" }}">
          {% for action in actions %}
            {% if action.external == false or action.external == null %}
              {% set card_action_icon = "chevron-right" %}
            {% else %}
              {% set card_action_icon = "external-link" %}
            {% endif %}

            <div class="{{ "#{base_class}__action" }}">
              {% include "@bolt-components-button/button.twig" with {
                text: action.text,
                url: action.url,
                style: "text",
                width: "full",
                align: "start",
                icon: {
                  name: card_action_icon,
                },
              } only %}
            </div>
          {% endfor %}
        </div>
      {% endif %}
    {% endif %}
  </{{ tag }}>
</bolt-card>
