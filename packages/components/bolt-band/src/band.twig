{% set schema = bolt.data.components["@bolt-components-band"].schema %}

{% if enable_json_schema_validation %}
  {{ validate_data_schema(schema, _self) | raw }}
{% endif %}

{# Variables #}
{% set base_class = "c-bolt-band" %}
{% set attributes = create_attribute(attributes|default({})) %}
{% set inner_attributes = create_attribute({}) %}

{# Set up checks to validate that the component's prop values are allowed, based on the component's schema #}
{% set tag_options = schema.properties.tag.enum %}
{% set size_options = schema.properties.size.enum %}
{% set theme_options = schema.properties.theme.enum %}

{# Check that the component's current prop values are valid. if not, default to the schema default #}
{% set tag = tag in tag_options ? tag : schema.properties.tag.default %}
{% set size = size in size_options ? size : schema.properties.size.default %}
{% set theme = theme in theme_options ? theme : schema.properties.theme.default %}
{% set full_bleed = full_bleed is sameas(true) or full_bleed is sameas(false) ? full_bleed : schema.properties.full_bleed.default %}

{# Deprecated #}
{% if fullBleed %}
  {% set fullBleed = full_bleed %}
{% endif %}
{% if contentTag %}
  {% set contentTag = null %}
{% endif %}
{% if row_gutter %}
  {% set row_gutter = null %}
{% endif %}
{% if content_row_start %}
  {% set content_row_start = null %}
{% endif %}
{% if items %}
  {% set items = null %}
{% endif %}

{# Array of classes based on the defined + default props #}
{% set classes = [
  base_class,
  size in size_options and size != "none" ? "#{base_class}--#{size}" : "",
  theme in theme_options and theme != "none" ? "t-bolt-#{theme}" : "",
  full_bleed ? "#{base_class}--full-bleed",
] %}

{#
  Sort classes passed in via attributes into two groups:
  1. Those that should be applied to the inner tag (namely, "is-" and "has-" classes)
  2. Those that should be applied to the outer custom element (everything else EXCEPT c-bolt-* classes, which should never be passed in via attributes)
#}
{% set outer_classes = [] %}
{% set inner_classes = classes %}

{% for class in attributes["class"] %}
  {% if class starts with "is-" or class starts with "has-" %}
    {% set inner_classes = inner_classes|merge([class]) %}
  {% elseif class starts with "c-bolt-" == false %}
    {% set outer_classes = outer_classes|merge([class]) %}
  {% endif %}
{% endfor %}

{# band component's custom element wrapper #}
<bolt-band
  {% if tag %} tag="{{ tag }}" {% endif %}
  {% if size %} size="{{ size }}" {% endif %}
  {% if theme %} theme="{{ theme }}" {% endif %}
  {% if full_bleed %} full-bleed {% endif %}
  {% if outer_classes %} class="{{ outer_classes|join(' ') }}" {% endif %}
  {{ attributes | without("class") }}
>
  <{{ tag }} {{ inner_attributes.addClass(inner_classes) }}>
    {# Render background if there is any #}
    {% if background %}
      {% include "@bolt-components-background/background.twig" with background only %}
    {% endif %}

    {# Setting a block so it doesn't break legacy embeds #}
    {% set regular_content %}
      {% block band_content %}
        {{ content }}
      {% endblock %}
    {% endset %}

    {% set regular_content_wrapper %}
      <div class="{{ "#{base_class}__content" }}">
        {% include "@bolt/wrapper.twig" with {
          content: regular_content,
        } only %}
      </div>
    {% endset %}

    {# Render pinned content if there is any #}
    {% if pinned_content %}
      {% set pinned_content_upper = pinned_content.upper %}
      {% set pinned_content_lower = pinned_content.lower %}

      {% if pinned_content_upper %}
        <div class="{{ "#{base_class}__content #{base_class}__content--pinned #{base_class}__content--pinned-upper" }}">
          {% set pinned_content_upper_items %}
            <div class="{{ "#{base_class}__pinned-items" }}">
              {% for item in pinned_content_upper %}
                {% set item_align = item.align %}
                {% set item_classes = [
                  "#{base_class}__pinned-item",
                  item_align ? "#{base_class}__pinned-item--#{item_align}" : "",
                ] %}

                <div {{ attributes.addClass(item_classes) }}>
                  {{ item.content }}
                </div>
              {% endfor %}
            </div>
          {% endset %}

          {% include "@bolt/wrapper.twig" with {
            content: pinned_content_upper_items,
          } only %}
        </div>
      {% endif %}

      {{ regular_content_wrapper }}

      {% if pinned_content_lower %}
        <div class="{{ "#{base_class}__content #{base_class}__content--pinned #{base_class}__content--pinned-lower" }}">
          {% set pinned_content_lower_items %}
            <div class="{{ "#{base_class}__pinned-items" }}">
              {% for item in pinned_content_lower %}
                <div class="{{ "#{base_class}__pinned-item #{base_class}__pinned-item--#{item.align}" }}">
                  {{ item.content }}
                </div>
              {% endfor %}
            </div>
          {% endset %}

          {% include "@bolt/wrapper.twig" with {
            content: pinned_content_lower_items,
          } only %}
        </div>
      {% endif %}
    {% else %}

    {# Otherwise, render just the content #}
      {{ regular_content_wrapper }}
    {% endif %}
  </{{ tag }}>
</bolt-band>
