{% set schema = bolt.data.components["@bolt-components-video"].schema %}

{% if enable_json_schema_validation %}
  {{ validate_data_schema(schema, _self) | raw }}
{% endif %}

{# if videoAttributes %}
  {% set attributes = videoAttributes | merge(attributes) %}

  {% for key, value in videoAttributes %}
    {% if attributes[key] %}
      {% set oldValue = attributes[key] %}
      {% set newValue = attributes[key] | merge(videoAttributes[key]) %}

      {% set attributes = attributes|merge({
        (key):newValue
      }) %}
    {% endif %}

  {% endfor %}
{% endif #}

{% set attributes = create_attribute(attributes|default({})) %}

{# force HTML5 Only Rendering + disable resizeManager in Brightcove to fix ability to click overlapping elements on iOS:
https://github.com/videojs/video.js/blob/22fd327076cb044c135c747086b58b7be64a747a/src/js/resize-manager.js#L19 #}
{% set attributes = attributes.setAttribute("data-setup", '{"techOrder": ["Html5"], "resizeManager": false}') %}

{# Map deprecated props to new ones #}
{% set video_id = video_id|default(videoId) %}
{% set player_id = player_id|default(playerId) %}
{% set account_id = account_id|default(accountId) %}

{# https://twig.symfony.com/doc/2.x/templates.html#other-operators #}
{# Map deprecated props to new ones, set defaults #}
{% set meta = meta ?? showMeta ?? schema.properties.meta.default %}
{% set meta_title = meta_title ?? showMetaTitle ?? schema.properties.meta_title.default %}
{% set controls = controls ?? schema.properties.controls.default %}
{% set autoplay = autoplay ?? schema.properties.autoplay.default %}
{% set loop = loop ?? schema.properties.loop.default %}
{% set is_background_video = is_background_video ?? isBackgroundVideo ?? schema.properties.is_background_video.default %}

{% if video_id %}
  {% set attributes = attributes.setAttribute("video-id", video_id) %}
{% endif %}

{% if player_id %}
  {% set attributes = attributes.setAttribute("player-id", player_id) %}
{% endif %}

{% if account_id %}
  {% set attributes = attributes.setAttribute("account-id", account_id) %}
{% endif %}

{% if video_uuid %}
  {% set attributes = attributes.setAttribute("video-uuid", video_uuid) %}
{% endif %}

{% if not meta %}
  {% set attributes = attributes.setAttribute("no-meta", true) %}
{% endif %}

{% if not meta_title %}
  {% set attributes = attributes.setAttribute("no-meta-title", true) %}
{% endif %}

{% if not controls %}
  {% set attributes = attributes.setAttribute("no-controls", true) %}
{% endif %}

{% if autoplay %}
  {% set attributes = attributes.setAttribute("autoplay", true) %}
{% endif %}

{% if loop %}
  {% set attributes = attributes.setAttribute("loop", true) %}
{% endif %}

{% if is_background_video %}
  {% set attributes = attributes.setAttribute("is-background-video", is_background_video) %}
{% endif %}

{% if not can_use_ratio %}
  {% set attributes = attributes.setAttribute("ratio", "none") %}
{% endif %}

{% if enabled_plugins %}
  {% set attributes = attributes.setAttribute("enabled-plugins", enabled_plugins) %}
{% endif %}

{% if disabled_plugins %}
  {% set attributes = attributes.setAttribute("disabled-plugins", disabled_plugins) %}
{% endif %}

{% if share_description %}
  {% set attributes = attributes.setAttribute("share-description", share_description|t) %}
{% endif %}

{# don't use the snake_case on-init config if the on-init attribute already exists #}
{% if on_init and not attributes["on-init"] %}
  {% set attributes = attributes.setAttribute("on-init", on_init) %}
{% endif %}

{% set customElementName = "#{bolt.data.config.namespace}-video" %}

<{{ customElementName }} {{ attributes }}></{{ customElementName }}>
